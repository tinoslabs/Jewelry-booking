{% extends "dashboard/base.html" %}
{% load static %}
{% block content %}

<div class="page-wrapper">
<div class="content">
<div class="page-header">
<div class="page-title">
<h4>Create Permission</h4>
<h6>Manage Create Permissions</h6>
</div>
</div>
  <form method="POST">
  {% csrf_token %}
  <div class="card">
    <div class="card-body">

      <h4>Edit Permissions for Role: {{ role.get_name_display }}</h4>

      <div class="col-12 mb-3">
        <label class="inputcheck">
          Select All
          <input type="checkbox" id="select-all">
          <span class="checkmark"></span>
        </label>
      </div>

      <div class="row">
        <div class="col-12">
          <div class="productdetails product-respon">
            <ul>
              {% for module, perms in permissions_dict.items %}
              <li>
                <h4>{{ module }}</h4>
                <div class="input-checkset">
                  <ul>
                    {% for perm in perms %}
                    <li>
                      <label class="inputcheck">{{ perm }}
                        <input type="checkbox" name="permissions" value="{{ module }} - {{ perm }}"
                               {% if module|add:" - "|add:perm in existing_permissions %}checked{% endif %}>
                        <span class="checkmark"></span>
                      </label>
                    </li>
                    {% endfor %}
                    <li>
                      <label class="inputcheck">Select All
                        <input type="checkbox" class="select-module">
                        <span class="checkmark"></span>
                      </label>
                    </li>
                  </ul>
                </div>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary">Update Permissions</button>
        </div>
      </div>
    </div>
  </div>
</form>




</div>
</div>
</div>

<!-- JavaScript to handle Select All -->
<!-- JavaScript for checkbox handling -->
 <script>
document.getElementById("select-all").addEventListener("change", function() {
    let checkboxes = document.querySelectorAll("input[type='checkbox'][name='permissions']");
    checkboxes.forEach(cb => cb.checked = this.checked);
});
</script>
<script>
  document.getElementById('select-all').addEventListener('change', function () {
    const checked = this.checked;
    document.querySelectorAll('input[type="checkbox"][name="permissions"]').forEach(cb => cb.checked = checked);
    document.querySelectorAll('.select-module').forEach(cb => cb.checked = checked);
  });

  document.querySelectorAll('.select-module').forEach(moduleCheckbox => {
    moduleCheckbox.addEventListener('change', function () {
      const parentUl = this.closest('ul');
      const checkboxes = parentUl.querySelectorAll('input[type="checkbox"][name="permissions"]');
      checkboxes.forEach(cb => cb.checked = this.checked);
    });
  });
</script>

{% comment %} <script>
  // Global select all
  document.getElementById('select-all').addEventListener('change', function () {
    const checked = this.checked;
    document.querySelectorAll('input[type="checkbox"][name="permissions"]').forEach(cb => cb.checked = checked);
    document.querySelectorAll('.select-module').forEach(cb => cb.checked = checked);
  });

  // Per-module select all
  document.querySelectorAll('.select-module').forEach(moduleCheckbox => {
    moduleCheckbox.addEventListener('change', function () {
      const parentUl = this.closest('ul');
      const checkboxes = parentUl.querySelectorAll('input[type="checkbox"][name="permissions"]');
      checkboxes.forEach(cb => cb.checked = this.checked);
    });
  });
</script> {% endcomment %}
{% endblock %}